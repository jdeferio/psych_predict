import io
import SQL_Connect

def main():
        cursor = SQL_Connect.connect_DB()

        output_file = 'cdrn_prevent_hosp_bef_2014_3.csv'

# Selects all patients in the cohort whom had a hospitalization for a preventable cause in 2014
        sql = "select two.*, pro.procedure_source_value from (select one.*, con.condition_source_value, con.condition_type_concept_id from (select v.person_id, v.visit_start_date, v.visit_concept_id, v.visit_occurrence_id from staging.visit_occurrence as v join staging.condition_occurrence as co on (v.visit_occurrence_id = co.visit_occurrence_id and v.person_id = co.person_id) where (v.visit_concept_id = 9201) and ((co.condition_source_value like 'ICD9CM:250.10') or (co.condition_source_value like 'ICD9CM:250.11') or (co.condition_source_value like 'ICD9CM:250.12') or (co.condition_source_value like 'ICD9CM:250.13') or (co.condition_source_value like 'ICD9CM:250.20') or (co.condition_source_value like 'ICD9CM:250.21') or (co.condition_source_value like 'ICD9CM:250.22') or (co.condition_source_value like 'ICD9CM:250.23') or (co.condition_source_value like 'ICD9CM:250.30') or (co.condition_source_value like 'ICD9CM:250.32') or (co.condition_source_value like 'ICD9CM:250.33') or (co.condition_source_value like 'ICD9CM:540.0') or (co.condition_source_value like 'ICD9CM:540.1') or (co.condition_source_value like 'ICD9CM:540.9') or (co.condition_source_value like 'ICD9CM:541') or (co.condition_source_value like 'ICD9CM:250.40') or (co.condition_source_value like 'ICD9CM:250.41') or (co.condition_source_value like 'ICD9CM:250.42') or (co.condition_source_value like 'ICD9CM:250.43') or (co.condition_source_value like 'ICD9CM:250.50') or (co.condition_source_value like 'ICD9CM:250.51') or (co.condition_source_value like 'ICD9CM:250.52') or (co.condition_source_value like 'ICD9CM:250.53') or (co.condition_source_value like 'ICD9CM:250.60') or (co.condition_source_value like 'ICD9CM:250.61') or (co.condition_source_value like 'ICD9CM:250.62') or (co.condition_source_value like 'ICD9CM:250.63') or (co.condition_source_value like 'ICD9CM:250.70') or (co.condition_source_value like 'ICD9CM:250.71') or (co.condition_source_value like 'ICD9CM:250.72') or (co.condition_source_value like 'ICD9CM:250.73') or (co.condition_source_value like 'ICD9CM:250.80') or (co.condition_source_value like 'ICD9CM:250.81') or (co.condition_source_value like 'ICD9CM:250.82') or (co.condition_source_value like 'ICD9CM:250.83') or (co.condition_source_value like 'ICD9CM:250.90') or (co.condition_source_value like 'ICD9CM:250.91') or (co.condition_source_value like 'ICD9CM:250.92') or (co.condition_source_value like 'ICD9CM:250.93') or (co.condition_source_value like 'ICD9CM:491.0') or (co.condition_source_value like 'ICD9CM:491.1') or (co.condition_source_value like 'ICD9CM:491.20') or (co.condition_source_value like 'ICD9CM:491.21') or (co.condition_source_value like 'ICD9CM:491.22') or (co.condition_source_value like 'ICD9CM:491.8') or (co.condition_source_value like 'ICD9CM:491.9') or (co.condition_source_value like 'ICD9CM:492.0') or (co.condition_source_value like 'ICD9CM:492.8') or (co.condition_source_value like 'ICD9CM:494') or (co.condition_source_value like 'ICD9CM:494.0') or (co.condition_source_value like 'ICD9CM:494.1') or (co.condition_source_value like 'ICD9CM:496') or (co.condition_source_value like 'ICD9CM:493.00') or (co.condition_source_value like 'ICD9CM:493.01') or (co.condition_source_value like 'ICD9CM:493.02') or (co.condition_source_value like 'ICD9CM:493.10') or (co.condition_source_value like 'ICD9CM:493.11') or (co.condition_source_value like 'ICD9CM:493.12') or (co.condition_source_value like 'ICD9CM:493.20') or (co.condition_source_value like 'ICD9CM:493.21') or (co.condition_source_value like 'ICD9CM:493.22') or (co.condition_source_value like 'ICD9CM:493.81') or (co.condition_source_value like 'ICD9CM:493.82') or (co.condition_source_value like 'ICD9CM:493.90') or (co.condition_source_value like 'ICD9CM:493.91') or (co.condition_source_value like 'ICD9CM:493.92') or (co.condition_source_value like 'ICD9CM:401.0') or (co.condition_source_value like 'ICD9CM:401.9') or (co.condition_source_value like 'ICD9CM:402.00') or (co.condition_source_value like 'ICD9CM:402.10') or (co.condition_source_value like 'ICD9CM:402.90') or (co.condition_source_value like 'ICD9CM:403.00') or (co.condition_source_value like 'ICD9CM:403.10') or (co.condition_source_value like 'ICD9CM:403.90') or (co.condition_source_value like 'ICD9CM:404.00') or (co.condition_source_value like 'ICD9CM:404.10') or (co.condition_source_value like 'ICD9CM:404.90') or (co.condition_source_value like 'ICD9CM:398.91') or (co.condition_source_value like 'ICD9CM:402.01') or (co.condition_source_value like 'ICD9CM:402.11') or (co.condition_source_value like 'ICD9CM:402.91') or (co.condition_source_value like 'ICD9CM:404.01') or (co.condition_source_value like 'ICD9CM:404.03') or (co.condition_source_value like 'ICD9CM:404.11') or (co.condition_source_value like 'ICD9CM:404.13') or (co.condition_source_value like 'ICD9CM:404.91') or (co.condition_source_value like 'ICD9CM:404.93') or (co.condition_source_value like 'ICD9CM:428.0') or (co.condition_source_value like 'ICD9CM:428.1') or (co.condition_source_value like 'ICD9CM:428.20') or (co.condition_source_value like 'ICD9CM:428.21') or (co.condition_source_value like 'ICD9CM:428.22') or (co.condition_source_value like 'ICD9CM:428.23') or (co.condition_source_value like 'ICD9CM:428.30') or (co.condition_source_value like 'ICD9CM:428.31') or (co.condition_source_value like 'ICD9CM:428.32') or (co.condition_source_value like 'ICD9CM:428.33') or (co.condition_source_value like 'ICD9CM:428.40') or (co.condition_source_value like 'ICD9CM:428.41') or (co.condition_source_value like 'ICD9CM:428.42') or (co.condition_source_value like 'ICD9CM:428.43') or (co.condition_source_value like 'ICD9CM:428.9') or (co.condition_source_value like 'ICD9CM:764.00') or (co.condition_source_value like 'ICD9CM:764.01') or (co.condition_source_value like 'ICD9CM:764.02') or (co.condition_source_value like 'ICD9CM:764.03') or (co.condition_source_value like 'ICD9CM:764.04') or (co.condition_source_value like 'ICD9CM:764.05') or (co.condition_source_value like 'ICD9CM:764.06') or (co.condition_source_value like 'ICD9CM:764.07') or (co.condition_source_value like 'ICD9CM:764.08') or (co.condition_source_value like 'ICD9CM:764.10') or (co.condition_source_value like 'ICD9CM:764.11') or (co.condition_source_value like 'ICD9CM:764.12') or (co.condition_source_value like 'ICD9CM:764.13') or (co.condition_source_value like 'ICD9CM:764.14') or (co.condition_source_value like 'ICD9CM:764.15') or (co.condition_source_value like 'ICD9CM:764.16') or (co.condition_source_value like 'ICD9CM:764.17') or (co.condition_source_value like 'ICD9CM:764.18') or (co.condition_source_value like 'ICD9CM:764.20') or (co.condition_source_value like 'ICD9CM:764.21') or (co.condition_source_value like 'ICD9CM:764.22') or (co.condition_source_value like 'ICD9CM:764.23') or (co.condition_source_value like 'ICD9CM:764.24') or (co.condition_source_value like 'ICD9CM:764.25') or (co.condition_source_value like 'ICD9CM:764.26') or (co.condition_source_value like 'ICD9CM:764.27') or (co.condition_source_value like 'ICD9CM:764.28') or (co.condition_source_value like 'ICD9CM:764.90') or (co.condition_source_value like 'ICD9CM:764.91') or (co.condition_source_value like 'ICD9CM:764.92') or (co.condition_source_value like 'ICD9CM:764.93') or (co.condition_source_value like 'ICD9CM:764.94') or (co.condition_source_value like 'ICD9CM:764.95') or (co.condition_source_value like 'ICD9CM:764.96') or (co.condition_source_value like 'ICD9CM:764.97') or (co.condition_source_value like 'ICD9CM:764.98') or (co.condition_source_value like 'ICD9CM:765.00') or (co.condition_source_value like 'ICD9CM:765.01') or (co.condition_source_value like 'ICD9CM:765.02') or (co.condition_source_value like 'ICD9CM:765.03') or (co.condition_source_value like 'ICD9CM:765.04') or (co.condition_source_value like 'ICD9CM:765.05') or (co.condition_source_value like 'ICD9CM:765.06') or (co.condition_source_value like 'ICD9CM:765.07') or (co.condition_source_value like 'ICD9CM:765.08') or (co.condition_source_value like 'ICD9CM:765.10') or (co.condition_source_value like 'ICD9CM:765.11') or (co.condition_source_value like 'ICD9CM:765.12') or (co.condition_source_value like 'ICD9CM:765.13') or (co.condition_source_value like 'ICD9CM:765.14') or (co.condition_source_value like 'ICD9CM:765.15') or (co.condition_source_value like 'ICD9CM:765.16') or (co.condition_source_value like 'ICD9CM:765.17') or (co.condition_source_value like 'ICD9CM:765.18') or (co.condition_source_value like 'ICD9CM:276.5') or (co.condition_source_value like 'ICD9CM:276.50') or (co.condition_source_value like 'ICD9CM:276.51') or (co.condition_source_value like 'ICD9CM:276.52') or (co.condition_source_value like 'ICD9CM:276.0') or (co.condition_source_value like 'ICD9CM:008.61') or (co.condition_source_value like 'ICD9CM:008.62') or (co.condition_source_value like 'ICD9CM:008.63') or (co.condition_source_value like 'ICD9CM:008.64') or (co.condition_source_value like 'ICD9CM:008.65') or (co.condition_source_value like 'ICD9CM:008.66') or (co.condition_source_value like 'ICD9CM:008.67') or (co.condition_source_value like 'ICD9CM:008.69') or (co.condition_source_value like 'ICD9CM:008.8') or (co.condition_source_value like 'ICD9CM:009.0') or (co.condition_source_value like 'ICD9CM:009.1') or (co.condition_source_value like 'ICD9CM:009.2') or (co.condition_source_value like 'ICD9CM:009.3') or (co.condition_source_value like 'ICD9CM:558.9') or (co.condition_source_value like 'ICD9CM:584.5') or (co.condition_source_value like 'ICD9CM:584.6') or (co.condition_source_value like 'ICD9CM:584.7') or (co.condition_source_value like 'ICD9CM:584.8') or (co.condition_source_value like 'ICD9CM:584.9') or (co.condition_source_value like 'ICD9CM:586') or (co.condition_source_value like 'ICD9CM:997.5') or (co.condition_source_value like 'ICD9CM:481') or (co.condition_source_value like 'ICD9CM:482.2') or (co.condition_source_value like 'ICD9CM:482.30') or (co.condition_source_value like 'ICD9CM:482.31') or (co.condition_source_value like 'ICD9CM:482.32') or (co.condition_source_value like 'ICD9CM:482.39') or (co.condition_source_value like 'ICD9CM:482.40') or (co.condition_source_value like 'ICD9CM:482.41') or (co.condition_source_value like 'ICD9CM:482.42') or (co.condition_source_value like 'ICD9CM:482.49') or (co.condition_source_value like 'ICD9CM:482.9') or (co.condition_source_value like 'ICD9CM:483.0') or (co.condition_source_value like 'ICD9CM:483.1') or (co.condition_source_value like 'ICD9CM:483.8') or (co.condition_source_value like 'ICD9CM:485') or (co.condition_source_value like 'ICD9CM:486') or (co.condition_source_value like 'ICD9CM:590.10') or (co.condition_source_value like 'ICD9CM:590.11') or (co.condition_source_value like 'ICD9CM:590.2') or (co.condition_source_value like 'ICD9CM:590.3') or (co.condition_source_value like 'ICD9CM:590.80') or (co.condition_source_value like 'ICD9CM:590.81') or (co.condition_source_value like 'ICD9CM:590.9') or (co.condition_source_value like 'ICD9CM:595.0') or (co.condition_source_value like 'ICD9CM:595.9') or (co.condition_source_value like 'ICD9CM:599.0') or (co.condition_source_value like 'ICD9CM:250.02') or (co.condition_source_value like 'ICD9CM:250.03') or (co.condition_source_value like 'ICD9CM:493.00') or (co.condition_source_value like 'ICD9CM:493.01') or (co.condition_source_value like 'ICD9CM:493.02') or (co.condition_source_value like 'ICD9CM:493.10') or (co.condition_source_value like 'ICD9CM:493.11') or (co.condition_source_value like 'ICD9CM:493.12') or (co.condition_source_value like 'ICD9CM:493.20') or (co.condition_source_value like 'ICD9CM:493.21') or (co.condition_source_value like 'ICD9CM:493.22') or (co.condition_source_value like 'ICD9CM:493.81') or (co.condition_source_value like 'ICD9CM:493.82') or (co.condition_source_value like 'ICD9CM:493.90') or (co.condition_source_value like 'ICD9CM:493.91') or (co.condition_source_value like 'ICD9CM:493.92') or (co.condition_source_value like 'ICD9CM:841.0') or (co.condition_source_value like 'ICD9CM:841.2') or (co.condition_source_value like 'ICD9CM:841.3') or (co.condition_source_value like 'ICD9CM:841.4') or (co.condition_source_value like 'ICD9CM:841.5') or (co.condition_source_value like 'ICD9CM:841.6') or (co.condition_source_value like 'ICD9CM:841.7') or (co.condition_source_value like 'ICD9CM:841.8') or (co.condition_source_value like 'ICD9CM:841.9') or (co.condition_source_value like 'ICD9CM:250.00') or (co.condition_source_value like 'ICD9CM:250.01') or (co.condition_source_value like 'ICD9CM:250.02') or (co.condition_source_value like 'ICD9CM:250.03') or (co.condition_source_value like 'ICD9CM:250.10') or (co.condition_source_value like 'ICD9CM:250.11') or (co.condition_source_value like 'ICD9CM:250.12') or (co.condition_source_value like 'ICD9CM:250.13') or (co.condition_source_value like 'ICD9CM:250.20') or (co.condition_source_value like 'ICD9CM:250.21') or (co.condition_source_value like 'ICD9CM:250.22') or (co.condition_source_value like 'ICD9CM:250.23') or (co.condition_source_value like 'ICD9CM:250.30') or (co.condition_source_value like 'ICD9CM:250.31') or (co.condition_source_value like 'ICD9CM:250.32') or (co.condition_source_value like 'ICD9CM:250.33') or (co.condition_source_value like 'ICD9CM:250.40') or (co.condition_source_value like 'ICD9CM:250.41') or (co.condition_source_value like 'ICD9CM:250.42') or (co.condition_source_value like 'ICD9CM:250.43') or (co.condition_source_value like 'ICD9CM:250.50') or (co.condition_source_value like 'ICD9CM:250.51') or (co.condition_source_value like 'ICD9CM:250.52') or (co.condition_source_value like 'ICD9CM:250.53') or (co.condition_source_value like 'ICD9CM:250.60') or (co.condition_source_value like 'ICD9CM:250.61') or (co.condition_source_value like 'ICD9CM:250.62') or (co.condition_source_value like 'ICD9CM:250.63') or (co.condition_source_value like 'ICD9CM:250.70') or (co.condition_source_value like 'ICD9CM:250.71') or (co.condition_source_value like 'ICD9CM:250.72') or (co.condition_source_value like 'ICD9CM:250.73') or (co.condition_source_value like 'ICD9CM:250.80') or (co.condition_source_value like 'ICD9CM:250.81') or (co.condition_source_value like 'ICD9CM:250.82') or (co.condition_source_value like 'ICD9CM:250.83') or (co.condition_source_value like 'ICD9CM:250.90') or (co.condition_source_value like 'ICD9CM:250.91') or (co.condition_source_value like 'ICD9CM:250.92') or (co.condition_source_value like 'ICD9CM:250.93')) and co.condition_type_concept_id in(44786627) and (v.visit_start_date < '2014-01-01')) as one join staging.condition_occurrence as con on one.visit_occurrence_id = con.visit_occurrence_id) as two left join staging.procedure_occurrence as pro on two.visit_occurrence_id=pro.visit_occurrence_id union select two.*, pro.procedure_source_value from (select one.*, con.condition_source_value, con.condition_type_concept_id from (select v.person_id, v.visit_start_date, v.visit_concept_id, v.visit_occurrence_id from mdd_control.visit_occurrence as v join mdd_control.condition_occurrence as co on (v.visit_occurrence_id = co.visit_occurrence_id and v.person_id = co.person_id) where (v.visit_concept_id = 9201) and ((co.condition_source_value like 'ICD9CM:250.10') or (co.condition_source_value like 'ICD9CM:250.11') or (co.condition_source_value like 'ICD9CM:250.12') or (co.condition_source_value like 'ICD9CM:250.13') or (co.condition_source_value like 'ICD9CM:250.20') or (co.condition_source_value like 'ICD9CM:250.21') or (co.condition_source_value like 'ICD9CM:250.22') or (co.condition_source_value like 'ICD9CM:250.23') or (co.condition_source_value like 'ICD9CM:250.30') or (co.condition_source_value like 'ICD9CM:250.32') or (co.condition_source_value like 'ICD9CM:250.33') or (co.condition_source_value like 'ICD9CM:540.0') or (co.condition_source_value like 'ICD9CM:540.1') or (co.condition_source_value like 'ICD9CM:540.9') or (co.condition_source_value like 'ICD9CM:541') or (co.condition_source_value like 'ICD9CM:250.40') or (co.condition_source_value like 'ICD9CM:250.41') or (co.condition_source_value like 'ICD9CM:250.42') or (co.condition_source_value like 'ICD9CM:250.43') or (co.condition_source_value like 'ICD9CM:250.50') or (co.condition_source_value like 'ICD9CM:250.51') or (co.condition_source_value like 'ICD9CM:250.52') or (co.condition_source_value like 'ICD9CM:250.53') or (co.condition_source_value like 'ICD9CM:250.60') or (co.condition_source_value like 'ICD9CM:250.61') or (co.condition_source_value like 'ICD9CM:250.62') or (co.condition_source_value like 'ICD9CM:250.63') or (co.condition_source_value like 'ICD9CM:250.70') or (co.condition_source_value like 'ICD9CM:250.71') or (co.condition_source_value like 'ICD9CM:250.72') or (co.condition_source_value like 'ICD9CM:250.73') or (co.condition_source_value like 'ICD9CM:250.80') or (co.condition_source_value like 'ICD9CM:250.81') or (co.condition_source_value like 'ICD9CM:250.82') or (co.condition_source_value like 'ICD9CM:250.83') or (co.condition_source_value like 'ICD9CM:250.90') or (co.condition_source_value like 'ICD9CM:250.91') or (co.condition_source_value like 'ICD9CM:250.92') or (co.condition_source_value like 'ICD9CM:250.93') or (co.condition_source_value like 'ICD9CM:491.0') or (co.condition_source_value like 'ICD9CM:491.1') or (co.condition_source_value like 'ICD9CM:491.20') or (co.condition_source_value like 'ICD9CM:491.21') or (co.condition_source_value like 'ICD9CM:491.22') or (co.condition_source_value like 'ICD9CM:491.8') or (co.condition_source_value like 'ICD9CM:491.9') or (co.condition_source_value like 'ICD9CM:492.0') or (co.condition_source_value like 'ICD9CM:492.8') or (co.condition_source_value like 'ICD9CM:494') or (co.condition_source_value like 'ICD9CM:494.0') or (co.condition_source_value like 'ICD9CM:494.1') or (co.condition_source_value like 'ICD9CM:496') or (co.condition_source_value like 'ICD9CM:493.00') or (co.condition_source_value like 'ICD9CM:493.01') or (co.condition_source_value like 'ICD9CM:493.02') or (co.condition_source_value like 'ICD9CM:493.10') or (co.condition_source_value like 'ICD9CM:493.11') or (co.condition_source_value like 'ICD9CM:493.12') or (co.condition_source_value like 'ICD9CM:493.20') or (co.condition_source_value like 'ICD9CM:493.21') or (co.condition_source_value like 'ICD9CM:493.22') or (co.condition_source_value like 'ICD9CM:493.81') or (co.condition_source_value like 'ICD9CM:493.82') or (co.condition_source_value like 'ICD9CM:493.90') or (co.condition_source_value like 'ICD9CM:493.91') or (co.condition_source_value like 'ICD9CM:493.92') or (co.condition_source_value like 'ICD9CM:401.0') or (co.condition_source_value like 'ICD9CM:401.9') or (co.condition_source_value like 'ICD9CM:402.00') or (co.condition_source_value like 'ICD9CM:402.10') or (co.condition_source_value like 'ICD9CM:402.90') or (co.condition_source_value like 'ICD9CM:403.00') or (co.condition_source_value like 'ICD9CM:403.10') or (co.condition_source_value like 'ICD9CM:403.90') or (co.condition_source_value like 'ICD9CM:404.00') or (co.condition_source_value like 'ICD9CM:404.10') or (co.condition_source_value like 'ICD9CM:404.90') or (co.condition_source_value like 'ICD9CM:398.91') or (co.condition_source_value like 'ICD9CM:402.01') or (co.condition_source_value like 'ICD9CM:402.11') or (co.condition_source_value like 'ICD9CM:402.91') or (co.condition_source_value like 'ICD9CM:404.01') or (co.condition_source_value like 'ICD9CM:404.03') or (co.condition_source_value like 'ICD9CM:404.11') or (co.condition_source_value like 'ICD9CM:404.13') or (co.condition_source_value like 'ICD9CM:404.91') or (co.condition_source_value like 'ICD9CM:404.93') or (co.condition_source_value like 'ICD9CM:428.0') or (co.condition_source_value like 'ICD9CM:428.1') or (co.condition_source_value like 'ICD9CM:428.20') or (co.condition_source_value like 'ICD9CM:428.21') or (co.condition_source_value like 'ICD9CM:428.22') or (co.condition_source_value like 'ICD9CM:428.23') or (co.condition_source_value like 'ICD9CM:428.30') or (co.condition_source_value like 'ICD9CM:428.31') or (co.condition_source_value like 'ICD9CM:428.32') or (co.condition_source_value like 'ICD9CM:428.33') or (co.condition_source_value like 'ICD9CM:428.40') or (co.condition_source_value like 'ICD9CM:428.41') or (co.condition_source_value like 'ICD9CM:428.42') or (co.condition_source_value like 'ICD9CM:428.43') or (co.condition_source_value like 'ICD9CM:428.9') or (co.condition_source_value like 'ICD9CM:764.00') or (co.condition_source_value like 'ICD9CM:764.01') or (co.condition_source_value like 'ICD9CM:764.02') or (co.condition_source_value like 'ICD9CM:764.03') or (co.condition_source_value like 'ICD9CM:764.04') or (co.condition_source_value like 'ICD9CM:764.05') or (co.condition_source_value like 'ICD9CM:764.06') or (co.condition_source_value like 'ICD9CM:764.07') or (co.condition_source_value like 'ICD9CM:764.08') or (co.condition_source_value like 'ICD9CM:764.10') or (co.condition_source_value like 'ICD9CM:764.11') or (co.condition_source_value like 'ICD9CM:764.12') or (co.condition_source_value like 'ICD9CM:764.13') or (co.condition_source_value like 'ICD9CM:764.14') or (co.condition_source_value like 'ICD9CM:764.15') or (co.condition_source_value like 'ICD9CM:764.16') or (co.condition_source_value like 'ICD9CM:764.17') or (co.condition_source_value like 'ICD9CM:764.18') or (co.condition_source_value like 'ICD9CM:764.20') or (co.condition_source_value like 'ICD9CM:764.21') or (co.condition_source_value like 'ICD9CM:764.22') or (co.condition_source_value like 'ICD9CM:764.23') or (co.condition_source_value like 'ICD9CM:764.24') or (co.condition_source_value like 'ICD9CM:764.25') or (co.condition_source_value like 'ICD9CM:764.26') or (co.condition_source_value like 'ICD9CM:764.27') or (co.condition_source_value like 'ICD9CM:764.28') or (co.condition_source_value like 'ICD9CM:764.90') or (co.condition_source_value like 'ICD9CM:764.91') or (co.condition_source_value like 'ICD9CM:764.92') or (co.condition_source_value like 'ICD9CM:764.93') or (co.condition_source_value like 'ICD9CM:764.94') or (co.condition_source_value like 'ICD9CM:764.95') or (co.condition_source_value like 'ICD9CM:764.96') or (co.condition_source_value like 'ICD9CM:764.97') or (co.condition_source_value like 'ICD9CM:764.98') or (co.condition_source_value like 'ICD9CM:765.00') or (co.condition_source_value like 'ICD9CM:765.01') or (co.condition_source_value like 'ICD9CM:765.02') or (co.condition_source_value like 'ICD9CM:765.03') or (co.condition_source_value like 'ICD9CM:765.04') or (co.condition_source_value like 'ICD9CM:765.05') or (co.condition_source_value like 'ICD9CM:765.06') or (co.condition_source_value like 'ICD9CM:765.07') or (co.condition_source_value like 'ICD9CM:765.08') or (co.condition_source_value like 'ICD9CM:765.10') or (co.condition_source_value like 'ICD9CM:765.11') or (co.condition_source_value like 'ICD9CM:765.12') or (co.condition_source_value like 'ICD9CM:765.13') or (co.condition_source_value like 'ICD9CM:765.14') or (co.condition_source_value like 'ICD9CM:765.15') or (co.condition_source_value like 'ICD9CM:765.16') or (co.condition_source_value like 'ICD9CM:765.17') or (co.condition_source_value like 'ICD9CM:765.18') or (co.condition_source_value like 'ICD9CM:276.5') or (co.condition_source_value like 'ICD9CM:276.50') or (co.condition_source_value like 'ICD9CM:276.51') or (co.condition_source_value like 'ICD9CM:276.52') or (co.condition_source_value like 'ICD9CM:276.0') or (co.condition_source_value like 'ICD9CM:008.61') or (co.condition_source_value like 'ICD9CM:008.62') or (co.condition_source_value like 'ICD9CM:008.63') or (co.condition_source_value like 'ICD9CM:008.64') or (co.condition_source_value like 'ICD9CM:008.65') or (co.condition_source_value like 'ICD9CM:008.66') or (co.condition_source_value like 'ICD9CM:008.67') or (co.condition_source_value like 'ICD9CM:008.69') or (co.condition_source_value like 'ICD9CM:008.8') or (co.condition_source_value like 'ICD9CM:009.0') or (co.condition_source_value like 'ICD9CM:009.1') or (co.condition_source_value like 'ICD9CM:009.2') or (co.condition_source_value like 'ICD9CM:009.3') or (co.condition_source_value like 'ICD9CM:558.9') or (co.condition_source_value like 'ICD9CM:584.5') or (co.condition_source_value like 'ICD9CM:584.6') or (co.condition_source_value like 'ICD9CM:584.7') or (co.condition_source_value like 'ICD9CM:584.8') or (co.condition_source_value like 'ICD9CM:584.9') or (co.condition_source_value like 'ICD9CM:586') or (co.condition_source_value like 'ICD9CM:997.5') or (co.condition_source_value like 'ICD9CM:481') or (co.condition_source_value like 'ICD9CM:482.2') or (co.condition_source_value like 'ICD9CM:482.30') or (co.condition_source_value like 'ICD9CM:482.31') or (co.condition_source_value like 'ICD9CM:482.32') or (co.condition_source_value like 'ICD9CM:482.39') or (co.condition_source_value like 'ICD9CM:482.40') or (co.condition_source_value like 'ICD9CM:482.41') or (co.condition_source_value like 'ICD9CM:482.42') or (co.condition_source_value like 'ICD9CM:482.49') or (co.condition_source_value like 'ICD9CM:482.9') or (co.condition_source_value like 'ICD9CM:483.0') or (co.condition_source_value like 'ICD9CM:483.1') or (co.condition_source_value like 'ICD9CM:483.8') or (co.condition_source_value like 'ICD9CM:485') or (co.condition_source_value like 'ICD9CM:486') or (co.condition_source_value like 'ICD9CM:590.10') or (co.condition_source_value like 'ICD9CM:590.11') or (co.condition_source_value like 'ICD9CM:590.2') or (co.condition_source_value like 'ICD9CM:590.3') or (co.condition_source_value like 'ICD9CM:590.80') or (co.condition_source_value like 'ICD9CM:590.81') or (co.condition_source_value like 'ICD9CM:590.9') or (co.condition_source_value like 'ICD9CM:595.0') or (co.condition_source_value like 'ICD9CM:595.9') or (co.condition_source_value like 'ICD9CM:599.0') or (co.condition_source_value like 'ICD9CM:250.02') or (co.condition_source_value like 'ICD9CM:250.03') or (co.condition_source_value like 'ICD9CM:493.00') or (co.condition_source_value like 'ICD9CM:493.01') or (co.condition_source_value like 'ICD9CM:493.02') or (co.condition_source_value like 'ICD9CM:493.10') or (co.condition_source_value like 'ICD9CM:493.11') or (co.condition_source_value like 'ICD9CM:493.12') or (co.condition_source_value like 'ICD9CM:493.20') or (co.condition_source_value like 'ICD9CM:493.21') or (co.condition_source_value like 'ICD9CM:493.22') or (co.condition_source_value like 'ICD9CM:493.81') or (co.condition_source_value like 'ICD9CM:493.82') or (co.condition_source_value like 'ICD9CM:493.90') or (co.condition_source_value like 'ICD9CM:493.91') or (co.condition_source_value like 'ICD9CM:493.92') or (co.condition_source_value like 'ICD9CM:841.0') or (co.condition_source_value like 'ICD9CM:841.2') or (co.condition_source_value like 'ICD9CM:841.3') or (co.condition_source_value like 'ICD9CM:841.4') or (co.condition_source_value like 'ICD9CM:841.5') or (co.condition_source_value like 'ICD9CM:841.6') or (co.condition_source_value like 'ICD9CM:841.7') or (co.condition_source_value like 'ICD9CM:841.8') or (co.condition_source_value like 'ICD9CM:841.9') or (co.condition_source_value like 'ICD9CM:250.00') or (co.condition_source_value like 'ICD9CM:250.01') or (co.condition_source_value like 'ICD9CM:250.02') or (co.condition_source_value like 'ICD9CM:250.03') or (co.condition_source_value like 'ICD9CM:250.10') or (co.condition_source_value like 'ICD9CM:250.11') or (co.condition_source_value like 'ICD9CM:250.12') or (co.condition_source_value like 'ICD9CM:250.13') or (co.condition_source_value like 'ICD9CM:250.20') or (co.condition_source_value like 'ICD9CM:250.21') or (co.condition_source_value like 'ICD9CM:250.22') or (co.condition_source_value like 'ICD9CM:250.23') or (co.condition_source_value like 'ICD9CM:250.30') or (co.condition_source_value like 'ICD9CM:250.31') or (co.condition_source_value like 'ICD9CM:250.32') or (co.condition_source_value like 'ICD9CM:250.33') or (co.condition_source_value like 'ICD9CM:250.40') or (co.condition_source_value like 'ICD9CM:250.41') or (co.condition_source_value like 'ICD9CM:250.42') or (co.condition_source_value like 'ICD9CM:250.43') or (co.condition_source_value like 'ICD9CM:250.50') or (co.condition_source_value like 'ICD9CM:250.51') or (co.condition_source_value like 'ICD9CM:250.52') or (co.condition_source_value like 'ICD9CM:250.53') or (co.condition_source_value like 'ICD9CM:250.60') or (co.condition_source_value like 'ICD9CM:250.61') or (co.condition_source_value like 'ICD9CM:250.62') or (co.condition_source_value like 'ICD9CM:250.63') or (co.condition_source_value like 'ICD9CM:250.70') or (co.condition_source_value like 'ICD9CM:250.71') or (co.condition_source_value like 'ICD9CM:250.72') or (co.condition_source_value like 'ICD9CM:250.73') or (co.condition_source_value like 'ICD9CM:250.80') or (co.condition_source_value like 'ICD9CM:250.81') or (co.condition_source_value like 'ICD9CM:250.82') or (co.condition_source_value like 'ICD9CM:250.83') or (co.condition_source_value like 'ICD9CM:250.90') or (co.condition_source_value like 'ICD9CM:250.91') or (co.condition_source_value like 'ICD9CM:250.92') or (co.condition_source_value like 'ICD9CM:250.93')) and co.condition_type_concept_id in(44786627) and (v.visit_start_date < '2014-01-01')) as one join mdd_control.condition_occurrence as con on one.visit_occurrence_id = con.visit_occurrence_id) as two left join staging.procedure_occurrence as pro on two.visit_occurrence_id=pro.visit_occurrence_id"

        cursor.execute(sql)

        with io.open(output_file, 'w', encoding='utf-8') as f:
            for index, row in enumerate(cursor):
                print(index)
                person_id = str(row[0])
                visit_start_date = str(row[1])
                visit_concept_id = str(row[2])
                visit_occurrence_id = str(row[3])
                condition_source_value = str(row[4])
                condition_type_concept_id = str(row[5])
                procedure_source_value = str(row[6])

                line = ','.join([
                    person_id, visit_start_date, visit_concept_id, visit_occurrence_id, condition_source_value,
                    condition_type_concept_id, procedure_source_value])

                f.write(line + '\n')

        print("Finished Reading!")

if __name__=='__main__':
    main()